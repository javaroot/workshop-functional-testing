import org.apache.tools.ant.taskdefs.condition.Os

buildscript {
  repositories {
    mavenCentral()
    jcenter()
  }
  dependencies {
    classpath "com.github.samueltbrown:gradle-cucumber-plugin:0.9"
  }
}

ext {
  groovyVersion = '2.4.5'
  gebVersion = '0.13.1'
  seleniumVersion = '2.51.0'
  cucumberJvmVersion = '1.2.2'
  chromeDriverVersion = '2.19'
  phantomJsVersion = '1.9.8'
}

apply plugin: 'groovy'
apply plugin: "com.github.samueltbrown.cucumber"
apply from: "osSpecificDownloads.gradle"

repositories {
  mavenCentral()
}


sourceCompatibility = 1.7
targetCompatibility = 1.7

dependencies {
  compile 'org.codehaus.groovy:groovy-all:2.4.3'
  testCompile "info.cukes:cucumber-core:1.2.2"
  testCompile "info.cukes:cucumber-groovy:1.2.2"
  testCompile "info.cukes:cucumber-junit:1.2.2"
  testCompile "org.gebish:geb-core:0.13.1"
  testCompile "org.seleniumhq.selenium:selenium-firefox-driver:2.52.0"
  testCompile "org.seleniumhq.selenium:selenium-support:2.52.0"
}

task wrapper(type: Wrapper) {
  gradleVersion = '2.9'
}


cucumber {
  def tagsToRun = System.getProperty("cucumber.tags")
  formats = ['pretty','json:build/cucumber.json','junit:build/cucumber.xml','html:build/reports/cucumber']
  tags = tagsToRun ? [tagsToRun] : []
}

tasks.cucumber {
  dependsOn unzipChromeDriver, unzipPhantomJs

  def chromeDriverFilename = Os.isFamily(Os.FAMILY_WINDOWS) ? "chromedriver.exe" : "chromedriver"
  def phantomJsFilename = Os.isFamily(Os.FAMILY_WINDOWS) ? "phantomjs.exe" : "bin/phantomjs"

  jvmOptions.systemProperties([
    "webdriver.chrome.driver": new File(unzipChromeDriver.outputs.files.singleFile, chromeDriverFilename).absolutePath,
    "phantomjs.binary.path": new File(unzipPhantomJs.outputs.files.singleFile, phantomJsFilename).absolutePath,
    //"geb.cucumber.step.packages": "pages",
    "geb.env": System.getProperty("geb.env")
  ])
}
